<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Agent Office Viz ‚Äî Playable</title>
  <style>
    :root {
      --bg:#0b1020; --panel:#121a33; --line:#2c3c6b; --text:#e9edff; --muted:#9aabde;
      --office:#1a274a; --kitchen:#3a2549; --room:#1d294d;
    }
    * { box-sizing: border-box; }
    body { margin:0; font-family: Inter,system-ui,Arial; background: radial-gradient(circle at 20% 10%, #1d2a55, var(--bg)); color:var(--text); padding:12px; }
    h1 { margin:0 0 8px; font-size:22px; }
    .sub { color:var(--muted); margin-bottom:10px; }
    .hud { display:flex; gap:8px; flex-wrap:wrap; margin-bottom:8px; }
    button { background:#334a84; border:1px solid #5875c4; color:#fff; border-radius:8px; padding:8px 12px; cursor:pointer; }
    .status { color:var(--muted); font-size:13px; }

    .map {
      max-width: 1200px; margin:auto; border:1px solid var(--line); border-radius:14px; overflow:hidden;
      background: color-mix(in srgb, var(--panel) 92%, black);
    }
    svg { width:100%; height:auto; display:block; }
    .zone { fill-opacity:.95; stroke:var(--line); stroke-width:2; }
    .label { fill:#cfe0ff; font-size:13px; font-weight:600; }
    .agent { transition: transform .15s linear; }
    .agent text { fill:#fff; font-size:12px; pointer-events:none; }

    .relations { max-width:1200px; margin:10px auto 0; border:1px solid var(--line); border-radius:10px; padding:10px; color:var(--muted); font-size:13px; }
  </style>
</head>
<body>
  <h1>üè¢ Agent Office Viz (–∏–≥—Ä–æ–≤–æ–π —Ä–µ–∂–∏–º)</h1>
  <div class="sub">–ê–≥–µ–Ω—Ç—ã —Ä–µ–∞–ª—å–Ω–æ –¥–≤–∏–≥–∞—é—Ç—Å—è –º–µ–∂–¥—É –∫–æ–º–Ω–∞—Ç–∞–º–∏, –æ—Ñ–∏—Å–æ–º –∏ –∫—É—Ö–Ω–µ–π –ø–æ —Å—Ç–∞–¥–∏—è–º —Ä–∞–±–æ—Ç—ã.</div>

  <div class="hud" style="max-width:1200px;margin:auto;">
    <button onclick="toggle()">‚èØ –°—Ç–∞—Ä—Ç/–ü–∞—É–∑–∞</button>
    <button onclick="nextStage(true)">‚è≠ –°–ª–µ–¥—É—é—â–∞—è —Å—Ç–∞–¥–∏—è</button>
    <button onclick="resetSim()">üîÑ –°–±—Ä–æ—Å</button>
    <div class="status" id="status"></div>
  </div>

  <div class="map">
    <svg id="scene" viewBox="0 0 1200 720" xmlns="http://www.w3.org/2000/svg">
      <rect x="0" y="0" width="1200" height="720" fill="#0f1730" />

      <rect class="zone" x="20" y="20" width="760" height="390" rx="18" fill="var(--office)" />
      <text class="label" x="38" y="45">–û–±—â–∏–π –æ—Ñ–∏—Å</text>

      <rect class="zone" x="800" y="20" width="380" height="390" rx="18" fill="var(--kitchen)" />
      <text class="label" x="818" y="45">–ö—É—Ö–Ω—è</text>

      <rect class="zone" x="20" y="430" width="145" height="260" rx="14" fill="var(--room)" />
      <text class="label" x="32" y="454">Arthur</text>
      <rect x="40" y="650" width="80" height="22" rx="6" fill="#5fb7ff" />

      <rect class="zone" x="175" y="430" width="145" height="260" rx="14" fill="var(--room)" />
      <text class="label" x="187" y="454">Invoker</text>
      <rect x="195" y="650" width="80" height="22" rx="6" fill="#5fb7ff" />

      <rect class="zone" x="330" y="430" width="145" height="260" rx="14" fill="var(--room)" />
      <text class="label" x="342" y="454">Chen</text>
      <rect x="350" y="650" width="80" height="22" rx="6" fill="#5fb7ff" />

      <rect class="zone" x="485" y="430" width="145" height="260" rx="14" fill="var(--room)" />
      <text class="label" x="497" y="454">Designer</text>
      <rect x="505" y="650" width="80" height="22" rx="6" fill="#5fb7ff" />

      <rect class="zone" x="640" y="430" width="145" height="260" rx="14" fill="var(--room)" />
      <text class="label" x="652" y="454">Tinker</text>
      <rect x="660" y="650" width="80" height="22" rx="6" fill="#5fb7ff" />

      <rect class="zone" x="795" y="430" width="145" height="260" rx="14" fill="var(--room)" />
      <text class="label" x="807" y="454">Oracle</text>
      <rect x="815" y="650" width="80" height="22" rx="6" fill="#5fb7ff" />

      <rect class="zone" x="950" y="430" width="110" height="260" rx="14" fill="var(--room)" />
      <text class="label" x="958" y="454">Io</text>
      <rect x="962" y="650" width="80" height="22" rx="6" fill="#5fb7ff" />

      <rect class="zone" x="1065" y="430" width="115" height="260" rx="14" fill="var(--room)" />
      <text class="label" x="1072" y="454">QA</text>
      <rect x="1080" y="650" width="80" height="22" rx="6" fill="#5fb7ff" />

      <g id="agents"></g>
    </svg>
  </div>

  <div class="relations" id="relations"></div>

<script>
const people = [
  {id:'arthur', name:'Arthur', emoji:'üß≠', color:'#63b3ff', home:[80,560]},
  {id:'bruce', name:'Invoker', emoji:'üé©', color:'#b38bff', home:[235,560]},
  {id:'chen', name:'Chen', emoji:'üìã', color:'#ff9ae6', home:[390,560]},
  {id:'designer', name:'Designer', emoji:'üé®', color:'#ff8a6b', home:[545,560]},
  {id:'tinker', name:'Tinker', emoji:'üíª', color:'#67dbff', home:[700,560]},
  {id:'oracle', name:'Oracle', emoji:'üîÆ', color:'#ff74b9', home:[855,560]},
  {id:'io', name:'Io', emoji:'‚öôÔ∏è', color:'#ffe680', home:[1000,560]},
  {id:'qa', name:'QA', emoji:'üõ°Ô∏è', color:'#7cff9e', home:[1120,560]}
];

const zones = {
  office:[[90,90],[260,120],[430,90],[600,120],[740,150],[510,260],[300,250],[160,300]],
  kitchen:[[845,120],[980,120],[1120,120],[900,230],[1060,250],[950,330]],
};

const relationText = 'ü§ù –°–≤—è–∑–∏: Arthur‚ÜîInvoker (–¥—Ä—É–∂–±–∞), Chen‚ÜîDesigner (—Å–∏–ª—å–Ω–∞—è —Ä–∞–±–æ—á–∞—è —Å–≤—è–∑–∫–∞), Tinker‚ÜîQA (–±–æ–µ–≤–æ–π –¥—É—ç—Ç), Oracle‚ÜîIo (–∏–Ω—Ñ—Ä–∞-–ø–∞—Ä—Ç–Ω—ë—Ä—ã).';
const randomEvents = [
  '–ù–æ–≤–∞—è –∑–∞–¥–∞—á–∞ –ø—Ä–∏–ª–µ—Ç–µ–ª–∞ –æ—Ç Alavi.',
  '–ó–∞–¥–∞—á–∞ –≤ –æ—á–µ—Ä–µ–¥–∏ –ø—É—Å—Ç–∞ ‚Äî —á–∞—Å—Ç—å –∫–æ–º–∞–Ω–¥—ã —É—Ö–æ–¥–∏—Ç –≤ –∫–æ–º–Ω–∞—Ç—ã.',
  'QA –Ω–∞—à—ë–ª –±–∞–≥, Tinker –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è –≤ –æ—Ñ–∏—Å.',
  'Invoker —Å–æ–±—Ä–∞–ª –±—ã—Å—Ç—Ä—ã–π sync —É –¥–æ—Å–∫–∏.',
  'Oracle —Å Io –æ–±—Å—É–∂–¥–∞—é—Ç –¥–µ–ø–ª–æ–π.',
  'Chen —É—Ç–æ—á–Ω—è–µ—Ç —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è —Å –¥–∏–∑–∞–π–Ω–µ—Ä–æ–º.'
];

const state = Object.fromEntries(people.map(p => [p.id, {x:p.home[0], y:p.home[1], tx:p.home[0], ty:p.home[1], mode:'room'}]));
let running = false;
let tickTimer;

// 1 real second = 1 simulated minute
let simMinutes = 9 * 60; // start 09:00
let cycleStep = 0;
const cycle = ['go_office','check_tasks','work_or_idle','return_room'];

const g = document.getElementById('agents');
function drawAgents(){
  g.innerHTML = people.map(p => `
    <g class="agent" id="a-${p.id}">
      <circle r="15" fill="${p.color}" cx="${state[p.id].x}" cy="${state[p.id].y}"/>
      <text x="${state[p.id].x-11}" y="${state[p.id].y+5}">${p.emoji}</text>
      <text x="${state[p.id].x-20}" y="${state[p.id].y+28}" font-size="10">${p.name}</text>
    </g>`).join('');
}

function rand(arr){ return arr[Math.floor(Math.random()*arr.length)] }
function pickOffice(){ const [x,y]=rand(zones.office); return [x+Math.random()*18,y+Math.random()*18]; }
function pickKitchen(){ const [x,y]=rand(zones.kitchen); return [x+Math.random()*16,y+Math.random()*16]; }
function hhmm(total){ const h = Math.floor((total%1440)/60).toString().padStart(2,'0'); const m=(total%60).toString().padStart(2,'0'); return `${h}:${m}`; }

function sendTo(agentId, where){
  const p = people.find(x => x.id===agentId);
  if (!p) return;
  if (where === 'office') {
    const [x,y] = pickOffice();
    Object.assign(state[agentId], {tx:x, ty:y, mode:'office'});
  } else if (where === 'kitchen') {
    const [x,y] = pickKitchen();
    Object.assign(state[agentId], {tx:x, ty:y, mode:'kitchen'});
  } else {
    Object.assign(state[agentId], {tx:p.home[0] + (Math.random()*20-10), ty:p.home[1] + (Math.random()*12-6), mode:'room'});
  }
}

function applyLogic(){
  // kitchen meetup every 10 simulated minutes
  if (simMinutes % 10 === 0) {
    const shuffled = [...people].sort(() => Math.random() - 0.5);
    const kitchenGroup = shuffled.slice(0, 2 + Math.floor(Math.random()*2));
    kitchenGroup.forEach(p => sendTo(p.id, 'kitchen'));
  }

  const step = cycle[cycleStep];
  const taskExists = Math.random() < 0.62; // randomness

  if (step === 'go_office') {
    people.forEach(p => sendTo(p.id, 'office'));
  }

  if (step === 'check_tasks') {
    if (!taskExists) {
      // no tasks: half go back to rooms
      people.forEach((p, i) => sendTo(p.id, i % 2 ? 'room' : 'office'));
    }
  }

  if (step === 'work_or_idle') {
    if (taskExists) {
      const workers = people.filter(() => Math.random() < 0.75);
      workers.forEach(p => sendTo(p.id, 'office'));
      people.filter(p => !workers.includes(p)).forEach(p => sendTo(p.id, 'room'));
    } else {
      people.forEach(p => sendTo(p.id, 'room'));
    }
  }

  if (step === 'return_room') {
    people.forEach(p => sendTo(p.id, 'room'));
  }

  const eventSuffix = Math.random() < 0.35 ? ` ‚Ä¢ ${rand(randomEvents)}` : '';
  document.getElementById('status').textContent = `[${hhmm(simMinutes)}] ${step.replaceAll('_',' ')}${eventSuffix}`;
  document.getElementById('relations').textContent = relationText;

  cycleStep = (cycleStep + 1) % cycle.length;
  simMinutes += 1;
}

function animate(){
  people.forEach(p => {
    const s = state[p.id];
    s.x += (s.tx - s.x) * 0.08;
    s.y += (s.ty - s.y) * 0.08;
    const node = document.getElementById(`a-${p.id}`);
    if (!node) return;
    const c = node.querySelector('circle');
    const t1 = node.querySelectorAll('text')[0];
    const t2 = node.querySelectorAll('text')[1];
    c.setAttribute('cx', s.x); c.setAttribute('cy', s.y);
    t1.setAttribute('x', s.x-11); t1.setAttribute('y', s.y+5);
    t2.setAttribute('x', s.x-20); t2.setAttribute('y', s.y+28);
  });
  requestAnimationFrame(animate);
}

function nextStage(){ applyLogic(); }
function loop(){ if(!running) return; applyLogic(); tickTimer=setTimeout(loop, 1000); }
function toggle(){ running=!running; if(running) loop(); else clearTimeout(tickTimer); }
function resetSim(){
  running=false; clearTimeout(tickTimer); cycleStep=0; simMinutes=9*60;
  people.forEach(p=>{state[p.id].x=p.home[0];state[p.id].y=p.home[1];state[p.id].tx=p.home[0];state[p.id].ty=p.home[1];state[p.id].mode='room';});
  applyLogic();
}

window.toggle = toggle; window.nextStage = nextStage; window.resetSim = resetSim;
drawAgents(); applyLogic(); animate();
</script>
</body>
</html>