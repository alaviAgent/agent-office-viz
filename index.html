<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Agent Office Viz ‚Äî Pixel Mode</title>
  <style>
    body{margin:0;background:#111827;color:#e5e7eb;font-family:system-ui;padding:12px}
    h1{margin:0 0 8px;font-size:20px}
    .sub{color:#9ca3af;margin-bottom:8px}
    .hud{display:flex;gap:8px;align-items:center;flex-wrap:wrap;margin-bottom:8px}
    button{background:#334155;color:#fff;border:1px solid #64748b;border-radius:8px;padding:7px 10px;cursor:pointer}
    #status{color:#cbd5e1;font-size:13px}
    canvas{display:block;max-width:1100px;width:100%;image-rendering:pixelated;border:2px solid #334155;border-radius:10px;background:#7ea5c5}
  </style>
</head>
<body>
  <h1>üè¢ Agent Office Viz ‚Äî Pixel Design</h1>
  <div class="sub">–°—Ç–∏–ª—å –∫–∞–∫ –Ω–∞ —Ä–µ—Ñ–µ—Ä–µ–Ω—Å–µ: –ø–∏–∫—Å–µ–ª—å–Ω–∞—è 2D —Å—Ü–µ–Ω–∞, –º–µ–±–µ–ª—å, –∫–æ–º–Ω–∞—Ç—ã, –∫—É—Ö–Ω—è, –∂–∏–≤–æ–µ –¥–≤–∏–∂–µ–Ω–∏–µ.</div>
  <div class="hud">
    <button onclick="toggle()">‚èØ –°—Ç–∞—Ä—Ç/–ü–∞—É–∑–∞</button>
    <button onclick="step()">‚è≠ –®–∞–≥</button>
    <button onclick="resetSim()">üîÑ –°–±—Ä–æ—Å</button>
    <span id="status"></span>
  </div>
  <canvas id="game" width="1100" height="620"></canvas>

<script>
const cvs = document.getElementById('game');
const ctx = cvs.getContext('2d');
ctx.imageSmoothingEnabled = false;

const agents = [
  ['arthur','#60a5fa'],['invoker','#a78bfa'],['chen','#f472b6'],['designer','#fb7185'],
  ['tinker','#22d3ee'],['oracle','#f43f5e'],['io','#facc15'],['qa','#4ade80']
].map((a,i)=>({id:a[0],color:a[1],x:80+i*60,y:560,tx:80+i*60,ty:560,home:[80+i*120,560]}));

const officePts=[[180,150],[260,180],[340,140],[460,170],[540,140],[420,250],[280,260]];
const kitchenPts=[[760,150],[840,170],[920,150],[1000,190],[900,280],[800,260]];
let running=false, simMin=9*60, cycle=0, timer;

function rnd(arr){return arr[(Math.random()*arr.length)|0]}
function hm(m){const h=((m/60)|0)%24,mm=m%60;return String(h).padStart(2,'0')+':'+String(mm).padStart(2,'0')}

function zoneTarget(kind){
  const p = kind==='kitchen'?rnd(kitchenPts):rnd(officePts);
  return [p[0]+Math.random()*22-11,p[1]+Math.random()*18-9];
}

function assign(){
  // cycle: office -> check task -> work/rest -> room
  const hasTask = Math.random()<0.65;
  const kitchenTick = simMin % 10 === 0;

  if(cycle===0){ agents.forEach(a=>{[a.tx,a.ty]=zoneTarget('office')}) }
  if(cycle===1){
    agents.forEach((a,i)=>{
      if(!hasTask && i%2===0){ a.tx=a.home[0]; a.ty=a.home[1]; }
      else {[a.tx,a.ty]=zoneTarget('office')}
    })
  }
  if(cycle===2){
    agents.forEach(a=>{
      if(hasTask && Math.random()<0.75){[a.tx,a.ty]=zoneTarget('office')} else {a.tx=a.home[0];a.ty=a.home[1]}
    })
  }
  if(cycle===3){ agents.forEach(a=>{a.tx=a.home[0];a.ty=a.home[1]}) }

  if(kitchenTick){
    [...agents].sort(()=>Math.random()-0.5).slice(0,3).forEach(a=>{[a.tx,a.ty]=zoneTarget('kitchen')})
  }

  const ev = ['—Å–∏–Ω–∫ –Ω–∞ –∫—É—Ö–Ω–µ','–Ω–æ–≤–∞—è –∑–∞–¥–∞—á–∞','–ø—É—Å—Ç–æ–π –±—ç–∫–ª–æ–≥','QA –Ω–∞—à—ë–ª –±–∞–≥','—Ä–µ–≤—å—é —É Invoker'][(Math.random()*5)|0];
  document.getElementById('status').textContent = `[${hm(simMin)}] ${['–ò–¥—É—Ç –≤ –æ—Ñ–∏—Å','–ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞–¥–∞—á','–†–∞–±–æ—Ç–∞/–ø—Ä–æ—Å—Ç–æ–π','–í–æ–∑–≤—Ä–∞—Ç –≤ –∫–æ–º–Ω–∞—Ç—ã'][cycle]} ‚Ä¢ ${ev}`;
  cycle=(cycle+1)%4; simMin++;
}

function drawFloor(x,y,w,h){
  ctx.fillStyle='#be9567'; ctx.fillRect(x,y,w,h);
  for(let i=0;i<w;i+=28){ctx.fillStyle=(i/28)%2?'#b8895d':'#c89d6f';ctx.fillRect(x+i,y,14,h)}
  for(let j=0;j<h;j+=20){ctx.fillStyle='rgba(60,35,15,.18)';ctx.fillRect(x,y+j,w,2)}
}

function drawFurniture(){
  // left office
  drawFloor(20,20,700,390);
  ctx.strokeStyle='#1f2937'; ctx.lineWidth=4; ctx.strokeRect(20,20,700,390);
  ctx.fillStyle='#9ca3af'; ctx.fillRect(70,70,180,40); // shelf
  ctx.fillStyle='#6b7280'; ctx.fillRect(70,115,180,16);
  ctx.fillStyle='#a3e635'; ctx.fillRect(295,70,18,18); // plant
  ctx.fillStyle='#4b5563'; ctx.fillRect(70,250,210,70); // sofa
  ctx.fillStyle='#d9b57a'; ctx.fillRect(330,220,170,90); // table
  ctx.fillStyle='#93c5fd'; ctx.fillRect(510,230,150,70); // sofa2

  // right kitchen
  drawFloor(740,20,340,390);
  ctx.strokeRect(740,20,340,390);
  ctx.fillStyle='#94a3b8'; ctx.fillRect(760,60,80,120); // fridge
  ctx.fillStyle='#cbd5e1'; ctx.fillRect(855,75,200,40); // counter
  ctx.fillStyle='#e2e8f0'; ctx.fillRect(790,240,220,80); // kitchen table
  ctx.fillStyle='#fca5a5'; ctx.fillRect(1020,88,20,20); // mug

  // rooms strip
  drawFloor(20,430,1060,170);
  ctx.strokeRect(20,430,1060,170);
  for(let i=0;i<8;i++){
    const x=30+i*132;
    ctx.strokeRect(x,440,122,150);
    ctx.fillStyle='#93c5fd'; ctx.fillRect(x+18,548,80,26); // bed
  }
}

function drawAgent(a){
  // chibi pixel body
  const x=a.x|0, y=a.y|0;
  ctx.fillStyle='#111827'; ctx.fillRect(x-10,y-20,20,22); // cloak
  ctx.fillStyle=a.color; ctx.fillRect(x-8,y-26,16,8); // hood
  ctx.fillStyle='#f8fafc'; ctx.fillRect(x-4,y-12,8,8); // face
  ctx.fillStyle='#0f172a'; ctx.fillRect(x-8,y+2,6,8); ctx.fillRect(x+2,y+2,6,8); // legs
}

function render(){
  ctx.clearRect(0,0,cvs.width,cvs.height);
  drawFurniture();
  agents.forEach(a=>{
    a.x += (a.tx-a.x)*0.09;
    a.y += (a.ty-a.y)*0.09;
    drawAgent(a);
  });
  requestAnimationFrame(render);
}

function loop(){if(!running)return;assign();timer=setTimeout(loop,1000)}
function toggle(){running=!running; if(running)loop(); else clearTimeout(timer)}
function step(){assign()}
function resetSim(){running=false;clearTimeout(timer);simMin=9*60;cycle=0;agents.forEach((a,i)=>{a.x=a.home[0];a.y=a.home[1];a.tx=a.home[0];a.ty=a.home[1]});assign()}
window.toggle=toggle;window.step=step;window.resetSim=resetSim;

assign(); render();
</script>
</body>
</html>