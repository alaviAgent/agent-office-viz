<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Agent Office Viz ‚Äî Pixel Simulation</title>
  <style>
    body{margin:0;background:#111827;color:#e5e7eb;font-family:system-ui;padding:12px}
    h1{margin:0 0 8px;font-size:20px}.sub{color:#9ca3af;margin-bottom:8px}
    .hud{display:flex;gap:8px;align-items:center;flex-wrap:wrap;margin-bottom:8px}
    button{background:#334155;color:#fff;border:1px solid #64748b;border-radius:8px;padding:7px 10px;cursor:pointer}
    #status{color:#cbd5e1;font-size:13px}
    canvas{display:block;max-width:1100px;width:100%;image-rendering:pixelated;border:2px solid #334155;border-radius:10px;background:#7ea5c5}
  </style>
</head>
<body>
  <h1>üè¢ Agent Office Viz ‚Äî –∂–∏–≤–æ–π –ø–∏–∫—Å–µ–ª—å–Ω—ã–π –æ—Ñ–∏—Å</h1>
  <div class="sub">–¢–µ–ø–µ—Ä—å –∞–≥–µ–Ω—Ç—ã —Ä–µ–∞–ª—å–Ω–æ –∏–¥—É—Ç –ø–æ –º–∞—Ä—à—Ä—É—Ç–∞–º + –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç –æ–±–ª–∞–∫–∞ –æ–±—â–µ–Ω–∏—è.</div>
  <div class="hud">
    <button onclick="toggle()">‚èØ –°—Ç–∞—Ä—Ç/–ü–∞—É–∑–∞</button>
    <button onclick="stepTick()">‚è≠ –®–∞–≥</button>
    <button onclick="resetSim()">üîÑ –°–±—Ä–æ—Å</button>
    <span id="status"></span>
  </div>
  <canvas id="game" width="1100" height="620"></canvas>

<script>
const cvs = document.getElementById('game');
const ctx = cvs.getContext('2d');
ctx.imageSmoothingEnabled = false;

const NAMES = ['Arthur','Invoker','Chen','Designer','Tinker','Oracle','Io','QA'];
const COLORS = ['#60a5fa','#a78bfa','#f472b6','#fb7185','#22d3ee','#f43f5e','#facc15','#4ade80'];

const HOME = Array.from({length:8},(_,i)=>[80+i*132+42,560]);
const OFFICE = [[190,170],[280,190],[360,160],[450,190],[540,165],[620,190],[330,260],[490,250]];
const KITCHEN = [[770,170],[840,190],[920,170],[1000,190],[900,280],[800,260]];
const OFFICE_DOOR=[700,390], KITCHEN_DOOR=[740,220], ROOMS_DOOR=[700,430];

const phrasesTask = ['–ï—Å—Ç—å –∑–∞–¥–∞—á–∞, —Ä–∞–±–æ—Ç–∞–µ–º','–ë–µ—Ä—ë–º —Ç–∏–∫–µ—Ç','–°–∏–Ω–∫ —Å Invoker','–î–µ–ª–∞–µ–º —Ñ–∏—á—É','–ü—Ä–æ–≤–µ—Ä—è—é PR'];
const phrasesNoTask = ['–ë—ç–∫–ª–æ–≥ –ø—É—Å—Ç','–ü–æ–∫–∞ —Ç–∏—Ö–æ','–ñ–¥—É –∑–∞–¥–∞—á—É'];
const phrasesKitchen = ['‚òï sync','–û–±–º–µ–Ω –æ–ø—ã—Ç–æ–º','–ï—Å—Ç—å –Ω–æ–≤–æ—Å—Ç–∏','–û–±—Å—É–¥–∏–ª–∏ –±–∞–≥'];

const agents = NAMES.map((n,i)=>(
  {id:n.toLowerCase(),name:n,color:COLORS[i],x:HOME[i][0],y:HOME[i][1],speed:1.4,queue:[],target:null,home:HOME[i],zone:'room',bubble:'',bubbleT:0}
));

let running=false, timer, simMin=9*60, phase=0;
// 1 —Å–µ–∫ = 1 —Å–∏–º –º–∏–Ω—É—Ç–µ

function hm(m){const h=((m/60)|0)%24,mm=m%60;return `${String(h).padStart(2,'0')}:${String(mm).padStart(2,'0')}`}
function r(arr){return arr[(Math.random()*arr.length)|0]}
function jitter(p){return [p[0]+(Math.random()*16-8), p[1]+(Math.random()*12-6)]}

function say(a,text,ms=2400){a.bubble=text;a.bubbleT=performance.now()+ms;}

function routeTo(a, zone, point){
  a.queue=[];
  if(zone==='office') a.queue.push(OFFICE_DOOR, jitter(point));
  else if(zone==='kitchen') a.queue.push(KITCHEN_DOOR, jitter(point));
  else a.queue.push(ROOMS_DOOR, [a.home[0]+(Math.random()*10-5), a.home[1]+(Math.random()*8-4)]);
  a.target=null;
  a.zone=zone;
}

function simulateTick(){
  const hasTask = Math.random() < 0.67;
  const kitchenTime = simMin % 10 === 0;

  // 4-—Ñ–∞–∑–Ω—ã–π —Ü–∏–∫–ª: –≤ –æ—Ñ–∏—Å -> —á–µ–∫ –∑–∞–¥–∞—á -> —Ä–∞–±–æ—Ç–∞ -> –¥–æ–º–æ–π
  if(phase===0){
    agents.forEach((a,i)=>routeTo(a,'office',OFFICE[i%OFFICE.length]));
    agents.forEach(a=>say(a,'–ò–¥—É –≤ –æ—Ñ–∏—Å'));
  }
  if(phase===1){
    agents.forEach((a,i)=>{
      if(hasTask){ routeTo(a,'office',OFFICE[(i+2)%OFFICE.length]); say(a,r(phrasesTask)); }
      else { if(Math.random()<0.5){ routeTo(a,'room',a.home); say(a,r(phrasesNoTask)); } }
    });
  }
  if(phase===2){
    agents.forEach((a,i)=>{
      if(hasTask && Math.random()<0.8){ routeTo(a,'office',OFFICE[(i+4)%OFFICE.length]); }
      else { routeTo(a,'room',a.home); }
    });
  }
  if(phase===3){
    agents.forEach(a=>{routeTo(a,'room',a.home); if(Math.random()<0.35) say(a,'–í–æ–∑–≤—Ä–∞—â–∞—é—Å—å');});
  }

  // –∫—É—Ö–æ–Ω–Ω—ã–µ –º–∏—Ç–∞–ø—ã –∫–∞–∂–¥—ã–µ 10 –º–∏–Ω—É—Ç
  if(kitchenTime){
    [...agents].sort(()=>Math.random()-0.5).slice(0,3).forEach((a,i)=>{
      routeTo(a,'kitchen',KITCHEN[(i+Math.floor(Math.random()*KITCHEN.length))%KITCHEN.length]);
      say(a,r(phrasesKitchen),2800);
    });
  }

  const lbl=['–ò–¥—É—Ç –≤ –æ—Ñ–∏—Å','–ü—Ä–æ–≤–µ—Ä—è—é—Ç –∑–∞–¥–∞—á–∏','–†–∞–±–æ—Ç–∞ / –ø–∞—É–∑–∞','–í–æ–∑–≤—Ä–∞—Ç –≤ –∫–æ–º–Ω–∞—Ç—ã'][phase];
  document.getElementById('status').textContent = `[${hm(simMin)}] ${lbl} ‚Ä¢ ${hasTask?'–∑–∞–¥–∞—á–∏ –µ—Å—Ç—å':'–∑–∞–¥–∞—á –Ω–µ—Ç'}`;
  phase=(phase+1)%4; simMin++;
}

function moveAgent(a){
  if(!a.target && a.queue.length) a.target = a.queue.shift();
  if(!a.target) return;
  const dx=a.target[0]-a.x, dy=a.target[1]-a.y, d=Math.hypot(dx,dy);
  if(d<=a.speed){ a.x=a.target[0]; a.y=a.target[1]; a.target=null; return; }
  a.x += dx/d*a.speed; a.y += dy/d*a.speed;
}

function drawFloor(x,y,w,h){
  ctx.fillStyle='#be9567'; ctx.fillRect(x,y,w,h);
  for(let i=0;i<w;i+=28){ctx.fillStyle=(i/28)%2?'#b8895d':'#c89d6f';ctx.fillRect(x+i,y,14,h)}
  for(let j=0;j<h;j+=20){ctx.fillStyle='rgba(60,35,15,.16)';ctx.fillRect(x,y+j,w,2)}
}
function drawMap(){
  ctx.clearRect(0,0,cvs.width,cvs.height);
  drawFloor(20,20,700,390); ctx.strokeStyle='#1f2937'; ctx.lineWidth=4; ctx.strokeRect(20,20,700,390);
  drawFloor(740,20,340,390); ctx.strokeRect(740,20,340,390);
  drawFloor(20,430,1060,170); ctx.strokeRect(20,430,1060,170);

  ctx.fillStyle='#9ca3af'; ctx.fillRect(70,70,180,40); ctx.fillRect(70,115,180,16);
  ctx.fillStyle='#4b5563'; ctx.fillRect(70,250,210,70);
  ctx.fillStyle='#d9b57a'; ctx.fillRect(330,220,170,90);
  ctx.fillStyle='#93c5fd'; ctx.fillRect(510,230,150,70);
  ctx.fillStyle='#94a3b8'; ctx.fillRect(760,60,80,120);
  ctx.fillStyle='#cbd5e1'; ctx.fillRect(855,75,200,40);
  ctx.fillStyle='#e2e8f0'; ctx.fillRect(790,240,220,80);

  for(let i=0;i<8;i++){
    const x=30+i*132;
    ctx.strokeRect(x,440,122,150); ctx.fillStyle='#93c5fd'; ctx.fillRect(x+18,548,80,26);
  }
}

function drawBubble(a){
  if(!a.bubble || performance.now()>a.bubbleT) return;
  const w=Math.max(58,a.bubble.length*6+10), h=20;
  const x=a.x-w/2, y=a.y-42;
  ctx.fillStyle='rgba(255,255,255,.95)'; ctx.fillRect(x,y,w,h);
  ctx.fillStyle='#111827'; ctx.font='10px sans-serif'; ctx.fillText(a.bubble,x+5,y+13);
}
function drawAgent(a){
  const x=a.x|0,y=a.y|0;
  ctx.fillStyle='rgba(0,0,0,.25)'; ctx.fillRect(x-8,y+10,16,3);
  ctx.fillStyle='#111827'; ctx.fillRect(x-10,y-20,20,22);
  ctx.fillStyle=a.color; ctx.fillRect(x-8,y-26,16,8);
  ctx.fillStyle='#f8fafc'; ctx.fillRect(x-4,y-12,8,8);
  ctx.fillStyle='#0f172a'; ctx.fillRect(x-8,y+2,6,8); ctx.fillRect(x+2,y+2,6,8);
  drawBubble(a);
}

function render(){
  drawMap();
  agents.forEach(a=>{moveAgent(a); drawAgent(a);});
  requestAnimationFrame(render);
}

function loop(){ if(!running) return; simulateTick(); timer=setTimeout(loop,1000); }
function toggle(){ running=!running; if(running) loop(); else clearTimeout(timer); }
function stepTick(){ simulateTick(); }
function resetSim(){
  running=false; clearTimeout(timer); simMin=9*60; phase=0;
  agents.forEach((a,i)=>{a.x=HOME[i][0];a.y=HOME[i][1];a.queue=[];a.target=null;a.bubble='';});
  simulateTick();
}
window.toggle=toggle; window.stepTick=stepTick; window.resetSim=resetSim;

simulateTick(); render();
</script>
</body>
</html>